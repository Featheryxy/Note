## 关系模型

关系（relation）：表

元组（tuple）：表中的一行

属性（attribute）：表中的一列

码（key）：表中某个属性组，能唯一确定一个元组

域（domian）：一组具有相同数据类型的值的集合

分量：元组中的一个属性值

关系模式：对关系的描述

> 关系名（属性1， 属性2，... ， 属性n)



数据模型中都有一个 **型（type）**和**值（value）**

> 关系型：（学号，姓名，年龄）
>
> 关系值：（20220419， 小明，18）



模式（schema) ：数据库中全体数据的逻辑结构和特征的描述，不涉及具体的值

实例（instance)：模式的一个具体值



外键：
$$
F为外键 \\
R(K, F, ...) --> R(K, ...) \\

参照关系 ---> 被参照关系 \\
n : 1
$$

## JOIN

### 理论

笛卡尔积
$$
R \quad in \quad k_1 \times n,  \quad S \quad in \quad k_2\times m \\
R \times S \quad in \quad (k_1 \times k_2, n+m)
$$
笛卡尔积: 元组之间的组合, 组合数为各个关系元组数的乘积

连接运算：在笛卡尔积上选取属性间满足一定条件的元组 

- 等值连接：行角度，

- 自然连接：列角度，消除重复属性列，是一种特殊的等值连接

- 外连接：将悬浮元组也保存在结果关系中，而在其他属性上上填空值（NULL)

  > 悬浮元组：在连接运算中不满足条件而被舍弃的元组



象集（images set)
$$
给定关系R(X, Z) \\
Z_x = \{ t[Z]|t \in R, t[X] = x \} \\
Z_x 称为象集 \\
t表示元组，Z为属性组，\\
t[Z]表示一个元组在属性组Z上的属性值，称为分量 \\
它表示R中属性组X上值为x的诸元组在Z上分量的集合 \\
$$


除运算
$$

$$


相关子查询：子查询的查询条件依赖父查询

不相关子查询: 子查询的查询条件不依赖父查询



```sql
select * from table1;
# table1 为元组变量，代表表中的
```

## 实践

### 数据库

```sql
create table `class` (
	`cls_id` int (11),
	`cls_name` varchar (60)
); 
insert into `class` (`cls_id`, `cls_name`) values('1','1班');
insert into `class` (`cls_id`, `cls_name`) values('2','2班');
insert into `class` (`cls_id`, `cls_name`) values('3','3班');

create table `student` (
	`stu_id` int (11),
	`stu_name` varchar (60),
	`cls_id` int (11),
	`gender` varchar (3)
); 
insert into `student` (`stu_id`, `stu_name`, `cls_id`, `gender`) values('1','小明','1','1');
insert into `student` (`stu_id`, `stu_name`, `cls_id`, `gender`) values('2','小红','1','0');
insert into `student` (`stu_id`, `stu_name`, `cls_id`, `gender`) values('3','小兰','4','0');

```

### join

```sql
SELECT * FROM class;

cls_id  cls_name  
------  ----------
     1  1班      
     2  2班      
     3  3班    
          
select * from student;     

stu_id  stu_name  cls_id  gender  
------  --------  ------  --------
     1  小明             1  1       
     2  小红             1  0       
     3  小兰             4  0    
     
-- 笛卡尔积
SELECT * FROM class a, student b;

cls_id  cls_name  stu_id  stu_name  cls_id  gender  
------  --------  ------  --------  ------  --------
     1  1班             1  小明             1  1       
     2  2班             1  小明             1  1       
     3  3班             1  小明             1  1       
     1  1班             2  小红             1  0       
     2  2班             2  小红             1  0       
     3  3班             2  小红             1  0       
     1  1班             3  小兰             4  0       
     2  2班             3  小兰             4  0       
     3  3班             3  小兰             4  0       
     
-- 全外连接, oracle中使用full join
SELECT * FROM class a 
LEFT OUTER JOIN STUDENT b ON a.cls_id=b.cls_id
UNION
SELECT * FROM class a 
RIGHT OUTER JOIN STUDENT b ON a.cls_id=b.cls_id;

cls_id  cls_name  stu_id  stu_name  cls_id  gender  
------  --------  ------  --------  ------  --------
     1  1班             1  小明             1  1       
     1  1班             2  小红             1  0       
     2  2班        (NULL)  (NULL)    (NULL)  (NULL)  
     3  3班        (NULL)  (NULL)    (NULL)  (NULL)  
(NULL)  (NULL)         3  小兰             4  0       


-- 左外连接 left [outer] join
SELECT * FROM class a 
LEFT OUTER JOIN STUDENT b ON a.cls_id=b.cls_id;

cls_id  cls_name  stu_id  stu_name  cls_id  gender  
------  --------  ------  --------  ------  --------
     1  1班             1  小明             1  1       
     1  1班             2  小红             1  0       
     2  2班        (NULL)  (NULL)    (NULL)  (NULL)  
     3  3班        (NULL)  (NULL)    (NULL)  (NULL)  
     
-- 右外连接 left [outer] join
SELECT * FROM class a 
RIGHT OUTER JOIN STUDENT b ON a.cls_id=b.cls_id;     

cls_id  cls_name  stu_id  stu_name  cls_id  gender  
------  --------  ------  --------  ------  --------
     1  1班             1  小明             1  1       
     1  1班             2  小红             1  0       
(NULL)  (NULL)         3  小兰             4  0       



-- 内连接 [inner] join
SELECT * FROM class a
INNER JOIN STUDENT b ON a.cls_id=b.cls_id;

cls_id  cls_name  stu_id  stu_name  cls_id  gender  
------  --------  ------  --------  ------  --------
     1  1班             1  小明             1  1       
     1  1班             2  小红             1  0      
     

```

### join and

- where  在join生成临时表后帅选元组
- join and 在join生成临时表前帅选元组

> 当使用left join, and后 关于主表的帅选无效

```sql
SELECT * FROM class a
LEFT JOIN STUDENT b ON a.cls_id=b.cls_id
WHERE a.cls_id = 1;

cls_id  cls_name  stu_id  stu_name  cls_id  gender  
------  --------  ------  --------  ------  --------
     1  1班             1  小明             1  1       
     1  1班             2  小红             1  0       
     
     
-- 由于使用left join, and后 关于主表的帅选无效
SELECT * FROM class a
LEFT JOIN STUDENT b ON a.cls_id=b.cls_id
AND a.cls_id = 1;

cls_id  cls_name  stu_id  stu_name  cls_id  gender  
------  --------  ------  --------  ------  --------
     1  1班             1  小明             1  1       
     1  1班             2  小红             1  0       
     2  2班        (NULL)  (NULL)    (NULL)  (NULL)  
     3  3班        (NULL)  (NULL)    (NULL)  (NULL)  
     
-- 等价于
SELECT * FROM class a
LEFT JOIN STUDENT b ON a.cls_id=b.cls_id;
cls_id  cls_name  stu_id  stu_name  cls_id  gender  
------  --------  ------  --------  ------  --------
     1  1班             1  小明             1  1       
     1  1班             2  小红             1  0       
     2  2班        (NULL)  (NULL)    (NULL)  (NULL)  
     3  3班        (NULL)  (NULL)    (NULL)  (NULL)  


SELECT * FROM student a
LEFT JOIN class b ON a.cls_id=b.cls_id 
WHERE b.cls_id = 4;     

stu_id  stu_name  cls_id  gender  cls_id  cls_name  
------  --------  ------  ------  ------  ----------    



SELECT * FROM class a
LEFT JOIN STUDENT b ON a.cls_id=b.cls_id 
AND b.`cls_id`=4

cls_id  cls_name  stu_id  stu_name  cls_id  gender  
------  --------  ------  --------  ------  --------
     1  1班        (NULL)  (NULL)    (NULL)  (NULL)  
     2  2班        (NULL)  (NULL)    (NULL)  (NULL)  
     3  3班        (NULL)  (NULL)    (NULL)  (NULL)  
              
SELECT * FROM student a
LEFT JOIN class b ON a.cls_id=b.cls_id 
WHERE b.cls_id = 3;

stu_id  stu_name  cls_id  gender  cls_id  cls_name  
------  --------  ------  ------  ------  ----------
     4  小军             3  0            3  3班       
     
SELECT * FROM class a
LEFT JOIN STUDENT b ON a.cls_id=b.cls_id 
AND b.`cls_id`=3

cls_id  cls_name  stu_id  stu_name  cls_id  gender  
------  --------  ------  --------  ------  --------
     3  3班             4  小军             3  0       
     1  1班        (NULL)  (NULL)    (NULL)  (NULL)  
     2  2班        (NULL)  (NULL)    (NULL)  (NULL)  
```



### 自然连接

`natural join` 不需要指定连接条件, 消除重复属性列，是一种特殊的等值连接

```sql
-- 内连接 [inner] join
SELECT * FROM class a
INNER JOIN STUDENT b ON a.cls_id=b.cls_id;

cls_id  cls_name  stu_id  stu_name  cls_id  gender  
------  --------  ------  --------  ------  --------
     1  1班             1  小明             1  1       
     1  1班             2  小红             1  0      
     
     
-- 自然连接 natural join 不需要指定连接条件
SELECT * FROM class a
NATURAL  JOIN STUDENT b 

cls_id  cls_name  stu_id  stu_name  gender  
------  --------  ------  --------  --------
     1  1班             1  小明        1       
     1  1班             2  小红        0       


-- 左外连接 left [outer] join
SELECT * FROM class a 
LEFT OUTER JOIN STUDENT b ON a.cls_id=b.cls_id;

cls_id  cls_name  stu_id  stu_name  cls_id  gender  
------  --------  ------  --------  ------  --------
     1  1班             1  小明             1  1       
     1  1班             2  小红             1  0       
     2  2班        (NULL)  (NULL)    (NULL)  (NULL)  
     3  3班        (NULL)  (NULL)    (NULL)  (NULL)  

     
-- 左外自然连接 left [outer] join
SELECT * FROM class a 
NATURAL LEFT OUTER JOIN STUDENT b ;

cls_id  cls_name  stu_id  stu_name  gender  
------  --------  ------  --------  --------
     1  1班             1  小明        1       
     1  1班             2  小红        0       
     2  2班        (NULL)  (NULL)    (NULL)  
     3  3班        (NULL)  (NULL)    (NULL)  
```







https://blog.csdn.net/weixin_36979214/article/details/105993194