## 重构原则



何为重构:对软件内部结构的一种调整，目的是在不改变软件可观察行为的前提下，提高其可理解性，降低其修改成本

两顶帽子: 添加新功能和重构。添加新功能时，我不应该修改既有代码，只管添加新功能;重构时我就不能再添加功能，只管调整代码的结构

何时重构:Don Roberts给了我一条准则：第一次做某件事时只管去做；第二次做类似的事会产生反感，但无
论如何还是可以去做；第三次再做类似的事，你就应该重构。





## 第一组重构

### 提炼函数（Extract Method）

曾用名：提炼函数（Extract Method）

反向重构：内联函数



**将意图与实现分开**

> 如果你需要花时间浏览一段代码才能弄清它到底在干什么，那么就应该将其提炼到一个函数中.并根据它所做的事为其命名

### 内联函数（Inline Method）

曾用名：内联函数（Inline Method）
反向重构：提炼函数

### 提炼变量（Extract Variable）

曾用名：引入解释性变量（Introduce Explaining Variable）

**表达式过于复杂**，如圆的面积`pi*math.power(r,2)`



### 内联变量

曾用名：内联临时变量（Inline Temp）



### 改变函数声明

迁移式做法，将要改变的函数内部提炼成一个新的函数

```
function circum(radius) {
	return 2 * Math.PI * radius;
}
// 迁移式做法，为circum改名，将circum标注为@deprecated
@deprecated
function circum(radius) {
	return circumference(radius);
}
function circumference(radius) {
	return 2 * Math.PI * radius;
}

```

### 封装变量

用函数封装变量，如public修饰的字段

如果变量被广泛使用，考虑运用封装变量（132）将其封装起来



引入参数对象，将对象封装成类



函数组合成类：对同一类数据操作的函数

## 封装

### 封装记录

可变数据：封装成类，通过copy将原来的数据转换成类中的字段，不修改原来的数据

记录型结构

- 需声明合法的字段名字
- 随机使用任何字段名称，如map，list，json散列
  - 小范围使用没有问题
  - 大范围使用由于不知道map里的字段，难以阅读，应该封装成类

### 封装集合

封装集合时人们常常犯一个错误：只对集合变量的访问进行了封装，但依然让取值函数返回集合本身。这使得集合的成员变量可以直接被修改，而封装它的类则全然不知，无法介入。



为避免此种情况，我会在类上提供一些修改集合的方法——通常是“添加”和“移除”方法，但是别人还是可能会直接修改集合中的元素，最好的办法是不要让集合的取值函数返回原始集合

